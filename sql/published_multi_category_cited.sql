CREATE TABLE BIORXIV_PUBLISHED_MULTI_CITED AS
SELECT FK_ITEMS, CODE FROM (
SELECT DISTINCT
    t1.FK_ITEMS, t6.CODE, COUNT(t6.CODE) AS CNT,
    MAX(COUNT(t6.CODE)) OVER (PARTITION by t1.FK_ITEMS) as MAXCNT
FROM
    BIORXIV_PUBLISHED_ARTICLES t1
INNER JOIN
    BIORXIV_PUBLISHED_MULTI_CAT t2
ON
    t1.ARTICLE_DOI = t2.ARTICLE_DOI   
INNER JOIN
    SCOPUS_B_2018.CITINGITEMS T3
ON
    t1.FK_ITEMS = t3.FK_ITEMS_CITING
INNER JOIN
    SCOPUS_B_2018.ITEMS t4
ON
    t3.FK_ITEMS_CITED = t4.PK_ITEMS
INNER JOIN
    SCOPUS_B_2018.SOURCES_CLASSIFICATIONS t5
ON
    t5.FK_SOURCES = t4.FK_SOURCES
INNER JOIN
    SCOPUS_B_2018.CLASSIFICATIONS t6
ON
    t6.PK_CLASSIFICATIONS = t5.FK_CLASSIFICATIONS
    AND t6.CLASSIFICATION_TYPE = 'ASJC'
    AND t6.CODE NOT IN ('1000', '1100', '1200', '1300', '1400', '1500', 
                        '1600', '1700', '1800', '1900', '2000', '2100', 
                        '2200', '2300', '2400', '2500', '2600', '2700', 
                        '2800', '2900', '3000', '3100', '3200', '3300', 
                        '3400', '3500', '3600')
GROUP BY t1.FK_ITEMS, t6.CODE)
WHERE
  CNT = MAXCNT

